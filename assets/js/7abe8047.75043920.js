"use strict";(self.webpackChunkm_19_v=self.webpackChunkm_19_v||[]).push([[8315],{7998:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"notes/software-engineering/ansible","title":"Ansible","description":"Ansible","source":"@site/docs/notes/software-engineering/ansible.md","sourceDirName":"notes/software-engineering","slug":"/notes/software-engineering/ansible","permalink":"/docs/notes/software-engineering/ansible","draft":false,"unlisted":false,"editUrl":"https://github.com/m19v/m19v.github.io/blob/main/docs/notes/software-engineering/ansible.md","tags":[],"version":"current","lastUpdatedBy":"m19v","lastUpdatedAt":1761828399000,"frontMatter":{"title":"Ansible"},"sidebar":"tutorialSidebar","previous":{"title":"Software Engineering","permalink":"/docs/category/software-engineering"},"next":{"title":"ArgoCD","permalink":"/docs/notes/software-engineering/argocd"}}');var l=s(4848),a=s(8453);const t={title:"Ansible"},o=void 0,r={},d=[{value:"Ansible",id:"ansible",level:2},{value:"Environment Setup",id:"environment-setup",level:2},{value:"Types of machines:",id:"types-of-machines",level:3},{value:"Installation",id:"installation",level:3},{value:"Ansible configuration",id:"ansible-configuration",level:2},{value:"ansible.cfg",id:"ansiblecfg",level:3},{value:"Ad-hoc commands",id:"ad-hoc-commands",level:2},{value:"Playbook",id:"playbook",level:2},{value:"Ansible commands",id:"ansible-commands",level:2},{value:"Playbook snippets",id:"playbook-snippets",level:2},{value:"Ansible Inventory",id:"ansible-inventory",level:2},{value:"WSL Playbook",id:"wsl-playbook",level:2},{value:"Roles",id:"roles",level:2},{value:"Variables",id:"variables",level:2},{value:"Advanced execution",id:"advanced-execution",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"SSH Overview",id:"ssh-overview",level:2},{value:"SSH Key-Based Authentication",id:"ssh-key-based-authentication",level:3},{value:"Adding SSH Key to SSH Agent",id:"adding-ssh-key-to-ssh-agent",level:3},{value:"References",id:"references",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"ansible",children:"Ansible"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Ansible is an open source engine that automates application deployment, orchestration, cloud provisioning etc."}),"\n",(0,l.jsx)(n.li,{children:"It uses human readable YAML syntax for Ansible Playbooks to describe automation jobs."}),"\n",(0,l.jsx)(n.li,{children:'Ansible is agent-less and designed for multi-tier deployment. Connects nodes via ssh by pushing "Ansible modules" which is removed after its execution.'}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"environment-setup",children:"Environment Setup"}),"\n",(0,l.jsx)(n.h3,{id:"types-of-machines",children:"Types of machines:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Control machine \u2212 a system on which Ansible is installed which manages other machines by executing playbook."}),"\n",(0,l.jsx)(n.li,{children:"Remote machine \u2212 a remote system managed by control machine."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"apt update\napt upgrade -y\n\napt install ansible -y\n"})}),"\n",(0,l.jsx)(n.h2,{id:"ansible-configuration",children:"Ansible configuration"}),"\n",(0,l.jsx)(n.h3,{id:"ansiblecfg",children:"ansible.cfg"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"[default]\ninventory = nameOfInventoryFile\nprivate_key_file = ~/.ssh/nameOfSSHKey\n"})}),"\n",(0,l.jsx)(n.h2,{id:"ad-hoc-commands",children:"Ad-hoc commands"}),"\n",(0,l.jsx)(n.h2,{id:"playbook",children:"Playbook"}),"\n",(0,l.jsx)(n.h2,{id:"ansible-commands",children:"Ansible commands"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'ansible all --key-file ~/.ssh/nameOfSSHKey -i inventory -m ping\n\nansible all --list-hosts\n\nansible all -m gather_facts\nansible all -m gather_facts --limit ip.address.of.single.host\n\n# sudo apt update to update package index\nansible all -i hosts -m apt -a update_cache=true --become --ask-become-pass\n\n# install tmux\nansible all -i hosts -m apt -a name=tmux --become --ask-become-pass\nansible all -i hosts -m apt -a "name=tmux state=latest" --become --ask-become-pass\n\n# sudo apt dist-upgrade\nansible all -i hosts -m apt -a upgrade=dist --become --ask-become-pass\n\nansible-playbook --ask-become-pass playbookFileName.yml\n\n# List tags of a playbook\nansible-playbook -i nameOfInventory --list-tags playbookFileName.yml\nansible-playbook -i nameOfInventory --tags "tag1,tag2,tag3" --ask-become-pass playbookFileName.yml\n\n# Syntax check\nansible-playbook --syntax-check <YAML>\n\n# Ansoble Vaults\nansible-vault create secret.yml\nansible-vault edit secret.yml\n\n# Ansoble Galaxy\nansible-galaxy install -r requirements.yml\n'})}),"\n",(0,l.jsx)(n.h2,{id:"playbook-snippets",children:"Playbook snippets"}),"\n",(0,l.jsx)(n.h2,{id:"ansible-inventory",children:"Ansible Inventory"}),"\n",(0,l.jsx)(n.p,{children:"A list of managed nodes that are logically organized. You create an inventory on the control node to describe host deployments to Ansible."}),"\n",(0,l.jsx)(n.h2,{id:"wsl-playbook",children:"WSL Playbook"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"See https://github.com/m19v/dotfiles/blob/main/README.md\n"})}),"\n",(0,l.jsx)(n.h2,{id:"roles",children:"Roles"}),"\n",(0,l.jsx)(n.h2,{id:"variables",children:"Variables"}),"\n",(0,l.jsx)(n.h2,{id:"advanced-execution",children:"Advanced execution"}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.h2,{id:"ssh-overview",children:"SSH Overview"}),"\n",(0,l.jsx)(n.h3,{id:"ssh-key-based-authentication",children:"SSH Key-Based Authentication"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Install OpenSSH on server"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Ubuntu\nsudo apt install openssh-server\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Create an SSH key pair (with a passphrase) for your normal user account and copy it to target server"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'\n# -t ed25519        type of algorith\n# -C                comment to ssh key\nssh-keygen -t ed25519 -C "ansible tutorial key"\n\n# following command will copy the public key to the host under the folder \n# .ssh/authorized_keys\nssh-copy-id -i ~/.ssh/id_ed25519.pub 1p.address.of.host\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Create a specific SSH key for Ansible Control Node (without passphrase as ansible can not enter passphrase everytime connecting target servers) and copy it to target server"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# with different name e.g. /home/username/.ssh/ansible\nssh-keygen -t ed25519 -C "ansible control node"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"adding-ssh-key-to-ssh-agent",children:"Adding SSH Key to SSH Agent"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Check if ssh-agent is running\neval "$(ssh-agent -s)"        \n# Add ssh key to ssh-agent\nssh-add ~/.ssh/nameOfSSHKey\n# Verify Key is added to ssh-agent\nssh-add -l\n'})}),"\n",(0,l.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/",children:"Ansible Documentation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/2.9/user_guide/playbooks_best_practices.html",children:"Ansible Best Practices"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/collections/ansible/builtin/",children:"Ansible Builtin Modules, Plugins etc."})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var i=s(6540);const l={},a=i.createContext(l);function t(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);